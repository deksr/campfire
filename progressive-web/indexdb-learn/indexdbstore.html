<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
</head>
<body>
	<h3>This is index db</h3>

	<script type="text/javascript" src =
"http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

	<script>
	// $(document).ready(function() {
	// lesson1: here we are checking to see if the browser supports indexb and then create a database


	// to delete a database:
	// if("indexedDB" in window) { 
	//   indexedDB.deleteDatabase("ora_idb1",1)
 //  }

  // Check to see if Indexdb exists in the browser window
  // if("indexedDB" in window) { 
  // // console.log("Indexdb exists")
  //  }


// 	if("indexedDB" in window) { 

//   //this deletes the database
// 	// indexedDB.deleteDatabase("ora_idb1",1)/


// 		var db;
// 		console.log("index db supported");

// 		var openRequest = indexedDB.open("ora_idb1",1);//open the database


// 		openRequest.onupgradeneeded = function(e) { 
// 			console.log("running onupgradeneeded");
//     }// this console logs at the very first time the database is created

//     openRequest.onsuccess = function(e) { 
//     	console.log("running onsuccess"); 
//       db = e.target.result;
//     }

//     openRequest.onerror = function(e) { 
//     	console.log("onerror!"); 
//     	console.dir(e);
//     };
// 	};
// })
</script>	

<script>
// lesson 2: we are creating a table. tables are called as objectStore 


// 	$(document).ready(function() {
// 		if("indexedDB" in window) { 
// 			var db;
// 		  console.log("index db supported");
// 		  var openRequest = indexedDB.open("ora_idb1",1); //open the database


// // check to see if the tabel name exisits. if no then create a table
// 		  openRequest.onupgradeneeded = function(e) { 
// 			console.log("running onupgradeneeded");
// 			var thisDB = e.target.result;
// 			if(!thisDB.objectStoreNames.contains("firstOS")) {
//             console.log("makng a new object store");
//             thisDB.createObjectStore("firstOS");
//         }
//     }// this console logs at the very first time the database is created

//     openRequest.onsuccess = function(e) { 
//     	console.log("running onsuccess"); 
//       db = e.target.result;
//       console.dir(db.objectStoreNames);
//     }

//     openRequest.onerror = function(e) { 
//     	console.log("onerror!"); 
//     	console.dir(e);
//     };
// 		}
//   })
</script>

<script>
// // lesson 3: creating object stores

// 	$(document).ready(function() {
// 		if("indexedDB" in window) { //checks if the indexdb exisits
// 		  console.log("index db supported");
// 		  var db;
// 		  var openRequest = indexedDB.open("ora_idb1",1); //create a database
// 		  openRequest.onupgradeneeded = function(e) { //connect to database
// 		  	console.log("running onupgradeneeded");
// 		  	var thisDB = e.target.result; 

// 		  	if(!thisDB.objectStoreNames.contains("people")) { 
// 		  		thisDB.createObjectStore("people", {keyPath: "email"}); //create table called people with primary key
//         }

//         if(!thisDB.objectStoreNames.contains("notes")) { 
//         	thisDB.createObjectStore("notes", {autoIncrement:true}); //create table called notes with primary key
//         }

//         if(!thisDB.objectStoreNames.contains("logs")) { 
//         	thisDB.createObjectStore("logs",{keyPath:"id", autoIncrement:true});
//         }
//       }

//       openRequest.onsuccess = function(e) {
//       	console.log("running onsuccess");
//         db = e.target.result;
//         console.dir(db.objectStoreNames);
//       }

//       openRequest.onerror = function(e) { 
//       	console.log("onerror!"); 
//       	console.dir(e);
//       }
// 		}
//   })


</script>


<script>
// lesson 4: creating indexes

	// $(document).ready(function() {
	// 	if("indexedDB" in window) { //checks if the indexdb exisits
	// 	  console.log("index db supported");
	// 	  var db;
	// 	  var openRequest = indexedDB.open("ora_idb1",1); //create a database
	// 	  openRequest.onupgradeneeded = function(e) { //connect to database
	// 	  	console.log("running onupgradeneeded");
	// 	  	var thisDB = e.target.result; 

	// 	  	if(!thisDB.objectStoreNames.contains("people")) { 
	// 	  		var peopleOS = thisDB.createObjectStore("people", {keyPath: "email"}); //create table called people with primary key
	// 	  		peopleOS.createIndex("gender", "gender", {unique:false});
 //          peopleOS.createIndex("ssn", "ssn", {unique:true});
 //          //
 //        }

 //        if(!thisDB.objectStoreNames.contains("notes")) { 
 //        	var notesOS = thisDB.createObjectStore("notes", {autoIncrement:true}); //create table called notes with primary key
 //        	notesOS.createIndex("title","title", {unique:false});
 //        }

 //        if(!thisDB.objectStoreNames.contains("logs")) { 
 //        	thisDB.createObjectStore("logs",{keyPath:"id", autoIncrement:true});
 //        }
 //      }

 //      openRequest.onsuccess = function(e) {
 //      	console.log("running onsuccess");
 //        db = e.target.result;
 //        console.dir(db.objectStoreNames);
 //      }

 //      openRequest.onerror = function(e) { 
 //      	console.log("onerror!"); 
 //      	console.dir(e);
 //      }
	// 	}
 //  })


</script>


<h2>Add Person</h2>
<input type="text" id="name" placeholder="Name"><br/> 
<input type="email" id="email" placeholder="Email"><br/> 
<button id="addPerson">Add Person</button>

<script>
// lesson 5: adding the data

  $(document).ready(function() {
		if("indexedDB" in window) { //checks if the indexdb exisits
		  console.log("index db supported");
		  var db;
		  var openRequest = indexedDB.open("ora_idb1",1); //create a database
		  openRequest.onupgradeneeded = function(e) { //connect to database
		  	console.log("running onupgradeneeded");
		  	var thisDB = e.target.result; 

		  	if(!thisDB.objectStoreNames.contains("people")) { 
		  		var peopleOS = thisDB.createObjectStore("people", {keyPath: "email"}); //create table called people with primary key

		  		// peopleOS.createIndex("gender", "gender", {unique:false});
      //     peopleOS.createIndex("ssn", "ssn", {unique:true});
          
        }

        if(!thisDB.objectStoreNames.contains("notes")) { 
        	var notesOS = thisDB.createObjectStore("notes", {autoIncrement:true}); //create table called notes with primary key
        	// notesOS.createIndex("title","title", {unique:false});
        }

        if(!thisDB.objectStoreNames.contains("logs")) { 
        	thisDB.createObjectStore("logs",{keyPath:"id", autoIncrement:true});
        }
      }

      openRequest.onsuccess = function(e) {
      	console.log("running onsuccess");
        db = e.target.result;
        console.dir(db.objectStoreNames);
        $("#addPerson").on("click", function(e){
        	var name = $("#name").val();
        	var email = $("#email").val();
        	console.log("About to add "+name+"/"+email);

        	var transaction = db.transaction(["people"],"readwrite");//here we are first defining the transaction. 
        	// db.transaction(["objectstore"],"type")
        	//transaction is when you are sending a data to the database. transactions type can be either read only or readwrite. readwrite is used when we are adding the data to teh database

        	var store = transaction.objectStore("people"); //here we are making the actual transaction to the obhjectstore

        	var person = {
        		name:name,
            email:email,
            created:new Date().getTime()
          }
          var request = store.add(person); //here we are adding

          request.onerror = function(e) { 
            console.log("Error",e.target.error.name); //some type of error handler
          }
          request.onsuccess = function(e) { 
          	console.log("Woot! Did it");
          }
        });
      }

      openRequest.onerror = function(e) { 
      	console.log("onerror!"); 
      	console.dir(e);
      }
		}
  })



</script>

</body>
</html>