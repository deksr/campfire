<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
</head>
<body>
		notification api <br> <br>


<div class="alert-box"></div>



	<script>

	// Notification.requestPermission().then(function(result) {
	//   // console.log(result);
	//   // using time out because i got the microtask error. Apparently the alert can't be used within promise. It blocks the javascript from running further so we give a set time out 
	//   if (result == 'denied'){
 //      setTimeout(() => {
 //        console.log(result);
 //        alert("An error occured");
 //      }, 0);
 //      return;	  
 //    }

	// });
  var grantedValue;

  function alertbox(){
 	  console.log("alert box code goes here");
    var alertbox = document.querySelector(".alert-box");
    alertbox.insertAdjacentHTML('beforeend', '<div id="alertbox"><input type="checkbox" id="grant" value="granted"> Yes, I grant permission for notification <br><br><input type="checkbox" id="no-grant" value="notgranted"> No, not interested <input type="submit" id= "settingsave" value="Save Settings"></div>');
  }
      


    //   var setsave = document.getElementById('settingsave')
    //   setsave.addEventListener('click', function(event) {
    // 	  console.log(event);
    // 	  var granted = document.getElementById('grant').checked;
    // 	  if (granted){
    // 	  	console.log("granted")
    // 	  	grantedyes = granted.value
    // 	    return granted
    // 	  }
    // 	  else{
    // 	  	console.log("permission denied")
    // 	  }
    // })




  // Let's check if the browser supports notifications
  if (!("Notification" in window)) {
    alert("This browser does not support system notifications");
  }

  // if this exists, then it moves to the enxt step
  // // Let's check whether notification permissions have already been granted

  else if (Notification.permission === "granted") {
    // If it's permission has been granted ,let's create a notification
    console.log("granted");
    var notification = new Notification("Hi there!");
  }

  // // Otherwise, we need to ask the user for for permission by opening a box on the DOM and then asking them for permission
  else if (Notification.permission !== 'denied') {
  	console.log("it's not denied")
    Notification.requestPermission(function (permission) {
      // If the user accepts, let's create a notification
      console.log("hello i'm requesting permisson");
        alertbox()
        // alert("please check the permission box");
        //here we will have a function running



      // if the permission was given on the dom (send an event called granted)
      var setsave = document.getElementById('settingsave')
      setsave.addEventListener('click', function(event) {
    	  console.log(event);

    	  var granted = document.getElementById('grant')
    	  var grantedyes = granted.checked;
    	  var grantedValue = granted.value

    	  console.log(granted)
    	  if (grantedyes === true){
    	  	console.log(grantedValue)
    	    if (permission === grantedValue) {
      	    console.log("check ok");
            var notification = new Notification("Hi there!");
          }
    	  }
    	  else{
    	  	console.log("permission denied")
    	  }
      })


    
    }); //Notification.requestPermission
  }

  // Finally, if the user has denied notifications and you 
  // want to be respectful there is no need to bother them any more.


	</script>
	
</body>
</html>